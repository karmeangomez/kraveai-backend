// lib/ua-database.js
const fs = require('fs');
const path = require('path');

// Banco con +58,000 UAs reales (aquí usamos muestra)
const userAgents = {
  mobile: [],
  desktop: [],
  tablet: []
};

try {
  const uaData = fs.readFileSync(path.join(__dirname, 'user-agents-min.json'), 'utf8');
  const parsedData = JSON.parse(uaData);

  userAgents.mobile = parsedData.mobile;
  userAgents.desktop = parsedData.desktop;
  userAgents.tablet = parsedData.tablet;

  console.log(`✅ Cargados ${userAgents.mobile.length + userAgents.desktop.length + userAgents.tablet.length} User-Agents`);
} catch (error) {
  console.error("❌ Error cargando User-Agents:", error);
  userAgents.mobile = [
    'Mozilla/5.0 (iPhone; CPU iPhone OS 16_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Mobile/15E148 Safari/604.1',
    'Mozilla/5.0 (Linux; Android 13; Pixel 7 Pro) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.82 Mobile Safari/537.36'
  ];
}

module.exports = {
  getRandomUA: (deviceType = 'mobile') => {
    const pool = userAgents[deviceType] || userAgents.mobile;
    return pool[Math.floor(Math.random() * pool.length)];
  },

  getDeviceFromUA: (ua) => {
    if (ua.includes('Mobile') || ua.includes('iPhone') || ua.includes('Android')) return 'mobile';
    if (ua.includes('Tablet') || ua.includes('iPad')) return 'tablet';
    return 'desktop';
  }
};
